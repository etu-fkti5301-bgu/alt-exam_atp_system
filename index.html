<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <title>Automated theorem proving system</title>

  <script type="text/javascript">
    const errorMessage = 'undefined', // TODO: Make types of errors: syntax, no solution, etc.
          stateComplete = 4, // Request to server completeed and we got some response.
          statusOK = 200; // HTTP status code if everything is OK.

    /* Unification algorithm has two input arguments. If one checked,
       show second empty input field. User inputs two terms P(...) and P(...). */
    function checkAlgorithm() {
      if (document.getElementById('alg').value == 'unf') {
        document.getElementById('sndInput').hidden = false;
      } else {
        document.getElementById('sndInput').hidden = true;
        document.getElementById('sndInput').value = '';
      }
    }

    function sendRequest() {
      var message = 'alg=' + encodeURIComponent(document.getElementById('alg').value) +
                    '&fstInput=' + encodeURIComponent(document.getElementById('fstInput').value) +
                    '&sndInput=' + encodeURIComponent(document.getElementById('sndInput').value);
                    /* In case of secondInput is empty, server handles it and doesn't care.
                       So we don't care too, send it. */

      var request = new XMLHttpRequest();
      request.open('POST', '/', true);
      request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      request.onreadystatechange = function() {
        var outputResult = '<p>' + errorMessage + '</p>'; // Result is an error by default. Has HTML format.

        if (request.readyState == stateComplete) {
          if (request.status == statusOK) {
            /* Server sends not rendered special symbols and '\n' in special cases (unf algorithm).
               Remove '\n' and make HTML to render specal symbols. */
            var serverResponse = decodeURIComponent(request.responseText).replace(/\\n/g, '')
                                                                         .replace(/\\/g, "&#");

            if (serverResponse != 'undefined') { // Server sent correct results as JSON string.
              response = JSON.parse(serverResponse);
              outputResult =
                '<p>' +
                '<b>Formula: </b>' + response.parsed[0] + '</br>' +
                '<b>Result: </b>'+ response.result[0] + '</br>' +
                '</p>';
            } // else isn't needed, because default result is an error. TODO: Make types of errors: syntax, no solution, etc.
          } else {
            /* In case of server is down. Actually, can't be possible because the page itself
               wouldn't be available. But must be handled.*/
            console.log('error: server: ' + request.status + ': ' + request.statusText);
          }
        }

        document.getElementById('output-content').innerHTML = outputResult;
        document.getElementById('output').style.visibility = 'visible';
      }

      request.send(message);
    }
  </script>
</head>

<body>

    <div class="header">
      <h1 class="header-title">
        Automated theorem proving system
      </h1>
    </div> <!-- end header -->

    <div class="main">

      <div id="form">
        <input id="fstInput" class="input-field" placeholder="none" size="64"/>

        <select id="alg" onchange="checkAlgorithm()">
          <option value="pnf">PNF</option>
          <option value="snf">SNF</option>
          <option value="rsl">Resolution</option>
          <option value="unf">Unification</option>
        </select>

        <button onclick="sendRequest()">Submit</button></br>

        <input id="sndInput" class="input-field" placeholder="none" size="64" hidden="true"/>
      </div>

      <div id="output"> <!-- this div should be made visible after receiving results -->
        <div id="output-content"></div> <!-- put results here -->
      </div>

    </div> <!-- end main -->

    <div class="footer"></div> <!-- end footer -->

</body>
